# git repo is cloned automatically
# base image is a minimal linux environment
language: minimal


install:
  # install miniconda and install packages into base environment
  - |
    wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda.sh
    bash ~/miniconda.sh -b -p $HOME/miniconda
    source "$HOME/miniconda/etc/profile.d/conda.sh"
    conda config --set always_yes yes
    conda update -q conda
    conda install python=3.7 bioconda::nextflow=19.07.0 conda-forge::pytest=5.1.2


before_script:
  # activate the conda environment  before each script
  - conda activate base


jobs:
  include:
    - stage: Run pipeline and unit tests
      # run Nextflow pipeline with test data set
      script: nextflow run ctdna-snv-caller-comparison.nf -profile test
      # Run pytest script on pipeline output
      script: pytest --verbose --junitxml=unit_tests/junit.xml
